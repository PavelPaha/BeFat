@page "/"

@inherits LayoutComponentBase
@using Microsoft.EntityFrameworkCore
@using Microsoft.Extensions.Configuration
@using Microsoft.Extensions.DependencyInjection
@using Microsoft.Extensions.Options
@using BeeFat.Data
@using BeeFat.Domain.Infrastructure
@using System.Globalization

@inject NavigationManager NavigationManager

@inject HomeHelper HomeHelper

<PageTitle>Home</PageTitle>

<div class="container">
    <div class="home-sidebar">
        <h2>Имя трека</h2>
        <button @onclick="RedirectToTrackEditing">Редактировать трек</button>
        <ul>
            @* <li><MudButton ButtonType="ButtonType.Button" OnClick="RedirectToTrackEditing" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Cancel</MudButton></li> *@
            <li></li>
            <li><button>Изменить параметры тела</button></li>
            <li><button>Калибровка</button></li>
        </ul>
    </div>
    
    <div class="main-content">
        <div class="daily-plan">
            <h2>План питания на сегодня</h2>
            <ul class="daily-food-list product-list">
                <li>
                    <div>Название продукта</div>
                    <div>Масса</div>
                    <div>Белки</div>
                    <div>Жиры</div>
                    <div>Углеводы</div>
                    <div>Калории</div>
                    <div>Выполнено</div>
                </li>
                @{
                    foreach (var product in HomeHelper.GetProductsByDay(DayOfWeek.Monday))
                    {
                        var foodInfo = product.Food.Macronutrient;
                        <li>
                            <div>@product.Name</div>
                            <div><span class="portion-size">@String.Format("{0} {1}", product.PortionSize, (product is FoodProductGram) ? "г" : "шт")</span></div>
                            <div><span class="portion-size">@foodInfo.Proteins г</span></div>
                            <div><span class="portion-size">@foodInfo.Fats г</span></div>
                            <div><span class="portion-size">@foodInfo.Carbohydrates г</span></div>
                            <div><span class="portion-size">@foodInfo.Calories ккал</span></div>
                            <div><button type="button" class="checkbox-button">&#10003;</button></div>
                        </li>
                    }
                    
                }
            </ul>
            @{
                var totalMacronutrient = HomeHelper.GetTotalMacronutrientsByDay(DayOfWeek.Monday);
            }
            <div class="total">
                Итого: <span class="parameter">@totalMacronutrient.Proteins г</span> белков, <span class="parameter">@totalMacronutrient.Fats г</span> жиров, <span class="parameter">@totalMacronutrient.Carbohydrates г</span> углеводов, <span class="parameter">@totalMacronutrient.Calories</span> калорий.
            </div>
        </div>
        <div class="next-days-plan product-list">
            <h3>План питания на следующие дни</h3>
            <ul class="product-list">
                @{
                    foreach (var products in HomeHelper.GetNextDaysProducts(DayOfWeek.Monday))
                    {
                        <li>
                            <div class="product">
                                <span class="product-name">
                                    @{
                                        @* <span>@HomeHelper.Days[dayNumber]: </span> *@
                                        var takenProducts = products.Take(4).ToList();
                                        for (var i = 0; i < takenProducts.Count; i++)
                                        {
                                            var product = takenProducts[i];
                                            @product.Name;
                                            if (i != takenProducts.Count - 1)
                                            {
                                                <span>, </span>
                                            }
                                        }

                                        if (products.Count() > 4)
                                        {
                                            <span>...</span>
                                        }
                                    }
                                </span>
                            </div>
                        </li>
                    }
                }
            </ul>
        </div>
    </div>
    
    <div class="home-sidebar">
        <div class="user-info">
            <img src="avatar.jpg">
            <span class="username">
                @* @{ *@
                @*     using (var context = new ApplicationDbContext(options, configuration)) *@
                @*     { *@
                @*         var user = context.BeeFatUsers.FirstOrDefault(); *@
                @*         @user.UserName.ToString() *@
                @*     } *@
                @* } *@
            </span>
        </div>
        <div class="parameters">
            <h3>Параметры</h3>
            <p>Масса: <span class="parameter">xxx кг</span></p>
            <p>Рост: <span class="parameter">xxx см</span></p>
            <p>Желаемые калории: <span class="parameter">xxx ккал</span></p>
        </div>
    </div>
</div>

@code {
    public void RedirectToTrackEditing()
    {
        NavigationManager.NavigateTo("/edit", forceLoad: true);
        throw new Exception();
    }
}